{% extends "base.html" %}

{% block title %}Gestion des Utilisateurs{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-users"></i> Gestion des Utilisateurs</h2>
            <a href="{{ url_for('create_user') }}" class="btn btn-primary">
                <i class="fas fa-user-plus"></i> Nouvel Utilisateur
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5><i class="fas fa-list"></i> Liste des Utilisateurs</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Nom d'utilisateur</th>
                                <th>Nom complet</th>
                                <th>Rôle</th>
                                <th>Créé le</th>
                                <th>Créé par</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr>
                                <td>{{ user[0] }}</td>
                                <td><strong>{{ user[1] }}</strong></td>
                                <td>{{ user[2] if user[2] else '-' }}</td>
                                <td>
                                    {% if user[3] == 'admin' %}
                                        <span class="badge bg-danger">Admin</span>
                                    {% else %}
                                        <span class="badge bg-info">Utilisateur</span>
                                    {% endif %}
                                </td>
                                <td>{{ user[4][:19] if user[4] else '-' }}</td>
                                <td>{{ user[6] if user[6] else 'Système' }}</td>
                                <td>
                                    {% if user[5] == 1 %}
                                        <span class="badge bg-success">Actif</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Inactif</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if user[0] != current_user.id %}
                                    <form method="POST" action="{{ url_for('toggle_user', user_id=user[0]) }}" style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-warning" title="Activer/Désactiver">
                                            <i class="fas fa-toggle-on"></i>
                                        </button>
                                    </form>
                                    <form method="POST" action="{{ url_for('delete_user', user_id=user[0]) }}" 
                                          style="display: inline;"
                                          onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur?');">
                                        <button type="submit" class="btn btn-sm btn-danger" title="Supprimer">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                    {% else %}
                                    <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Informations</h5>
            </div>
            <div class="card-body">
                <p><strong>Total utilisateurs:</strong> {{ users|length }}</p>
                <p><strong>Utilisateurs actifs:</strong> {{ users|selectattr('5', 'equalto', 1)|list|length }}</p>
                <p class="mb-0"><strong>Administrateurs:</strong> {{ users|selectattr('3', 'equalto', 'admin')|list|length }}</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card border-warning">
            <div class="card-header bg-warning">
                <h5><i class="fas fa-exclamation-triangle"></i> Notes Importantes</h5>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li>Seuls les administrateurs peuvent gérer les utilisateurs</li>
                    <li>Les utilisateurs inactifs ne peuvent pas se connecter</li>
                    <li>Vous ne pouvez pas modifier votre propre compte</li>
                    <li>Au moins un administrateur doit rester actif</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}